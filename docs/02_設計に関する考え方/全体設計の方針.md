
---

# 全体設計の方針

## 1. 設計における基本的な問題意識

本アプリケーションの設計において、最も壊れやすく、かつ慎重に扱うべきだと考えたのは、**評価フローと権限の関係**である。
人事考課業務では、「誰が」「どの段階で」「誰を評価できるか」というルールが複雑に絡み合っており、これらが曖昧なまま実装されると、業務として成立しなくなる。

一方で、UIの見た目や操作方法、あるいは認証の具体的な実装方式については、将来的に変更される可能性が高く、かつ差し替え可能な領域であると考えた。
そのため、本設計では「壊れてはいけない部分」と「変更されてもよい部分」を明確に分離することを出発点とした。

---

## 2. 全体構造の考え方

全体設計の方針を一言で表すと、
**「中心に業務ルールを置き、その周辺に技術を配置する構造」**
である。

人事考課という業務そのものは、使用する技術やフレームワークが変わっても本質的には変わらない。一方で、UI、データベース、認証基盤、インフラなどの技術要素は、時代や要件に応じて入れ替わる。

そこで本プロジェクトでは、業務ルールをアプリケーションの中心に据え、それ以外の技術的要素を周辺に配置する構造を採用した。
この考え方に基づき、ドメイン駆動設計（DDD）およびヘキサゴナルアーキテクチャの考え方を設計の軸としている。

---

## 3. バックエンドのレイヤ構成

バックエンドは、以下のレイヤに分割して設計した。

* **Domain**
  業務ルールそのものを表現する層。人事考課における不変のルールを集約する。

* **Application**
  ドメインをどの順序で呼び出し、どのようなユースケースとして提供するかを定義する層。

* **Adapters**
  Web API、データベース、外部サービスなど、技術的な入出力を担う層。

* **Infrastructure**
  フレームワーク設定や外部ライブラリとの接続など、アプリケーションを動かすための技術基盤。

この構成は、一般的なヘキサゴナルアーキテクチャ（Ports and Adapters）の考え方に従ったものである。

---

## 4. 各レイヤにおける責務の考え方

設計にあたっては、「何を書くか」以上に「**何を書いてはいけないか**」を意識した。

特に Domain 層については、以下を明確に意識している。

* 業務の不変ルールのみを置く
* 技術的な都合（HTTP、DB、外部SDKなど）を持ち込まない

業務ルールが適切に整理されていれば、UIや認証方式が変わっても、ドメイン自体は影響を受けない。
この前提を守ることが、設計全体の安定性につながると考えた。

逆に、技術的な詳細や実装上の都合は、Domain 層には置かず、Adapters や Infrastructure に押し出す方針とした。

---

## 5. フロントエンドとの境界

フロントエンドの責務は、原則として **APIを呼び出すこと**に限定した。
業務ルールや判断ロジックはすべてバックエンド側で保証し、フロントエンドは入力と表示に専念させる構成を目指している。

この方針により、

* UI変更が業務ロジックに影響しない
* 不正な操作や想定外の状態をバックエンドで一元的に防げる

といった効果を期待した。

---

## 6. 認証・外部サービスとの切り分け

認証・認可については、Auth0を利用し、「**このアプリケーションにログインできる人の管理**」までをAuth0の責務とした。
一方で、「ログインした人が、どの考課をどこまで操作できるか」といった業務上の権限判断は、アプリケーション側のドメインルールとして扱う方針としている。

本プロジェクトでは、外部SaaSとしてはAuth0のみを利用しており、それ以外の業務ロジックはすべて自前で管理する構成を選択した。

---

## 7. 実装を通じて見えた課題と振り返り

実装を進める中で、特に負荷が高かったのは、**考課フローの管理**であった。
評価段階や権限の組み合わせが想定以上に複雑であり、設計としては正しくとも、実装工数が大きくなった点は反省点である。

また、認証基盤については、当初からAuth0を前提に設計しておけば、より早い段階で構造を安定させられた可能性がある。

---

## 8. 全体設計に対する評価と後続への示唆

全体設計の方向性自体は、正しかったと考えている。
業務ルールを中心に据えた構造は、人事考課のようなドメインにおいて合理的であり、長期運用を見据えた場合にも有効である。

一方で、この設計を引き継ぐ後続の開発者にとって、最初に理解すべき点は **ドメイン駆動設計（DDD）の考え方そのもの**である。
構造を理解せずに実装を進めると、この設計は単なる複雑さとして受け取られてしまう可能性がある。

---

